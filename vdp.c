#include "RGZ80.h"

extern byte *z80_memory;

Uint8 colorpalette[16*3] = {
	0x00, 0x00, 0x00,
	0xAA, 0x00, 0x00,
	0x00, 0xAA, 0x00,
	0xAA, 0xAA, 0x00,
	0x00, 0x00, 0xAA,
	0xAA, 0x00, 0xAA,
	0x00, 0xAA, 0xAA,
	0xAA, 0xAA, 0xAA,
	0x55, 0x55, 0x55,
	0xFF, 0x55, 0x55,
	0x55, 0xFF, 0x55,
	0xFF, 0xFF, 0x55,
	0x55, 0x55, 0xFF,
	0xFF, 0x55, 0xFF,
	0x55, 0xFF, 0xFF,
	0xFF, 0xFF, 0xFF,
};

void rgz_grefresh(SDL_Surface *sdl_screen)
{
	for(int y = 0; y < 400; y+=2) {
		for(int x = 0; x < 640; x++) {
			Uint8 *q = &z80_memory[(y/2)*320+(x/2)];
			Uint32 *p = &((Uint32 *)sdl_screen->pixels)[y*(sdl_screen->pitch/4)+x];
			
			int dot = (*q >> ((x & 1) ? 0 : 4)) & 7;
			
			*p = 0xff000000;
			
			*p |= colorpalette[dot*3+0] << 16;
			*p |= colorpalette[dot*3+1] << 8;
			*p |= colorpalette[dot*3+2] << 0;
			
			p[sdl_screen->pitch/4] = *p;
		}
	}
}
